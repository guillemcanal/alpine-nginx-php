#!/bin/sh

apk add re2c alpine-sdk php5-dev autoconf libtool tidyhtml-dev@testing tidyhtml-libs@testing

PHP_VERSION=$(php -r "print PHP_VERSION;")

# Download PHP source

mkdir -p /opt
cd /opt
wget http://php.net/distributions/php-$PHP_VERSION.tar.gz
tar xzf php-$PHP_VERSION.tar.gz

# Install Tidy from source

cd /opt/php-$PHP_VERSION/ext/tidy
sed -i 's/buffio.h/tidybuffio.h/' *.c
phpize
./configure
make
make install
echo "extension=tidy.so" >> /etc/php5/conf.d/tidy.ini

# Cleanup
rm -rf /tmp/*
apk del re2c alpine-sdk php5-dev autoconf libtool tidyhtml-dev